<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stick-Bee Kalkulator</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3393/3393989.png">
    <link rel="icon" type="image/png" href="https://cdn-icons-png.flaticon.com/512/3393/3393989.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { overscroll-behavior-y: none; -webkit-tap-highlight-color: transparent; overflow-x: hidden; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 selection:bg-blue-500 selection:text-white">
<div id="root"></div>
<script type="text/babel" data-type="module">

/*****************
   ORIGINAL REACT CODE
   (vollständig wiederhergestellt)
*****************/

import React, { useState, useMemo, useEffect } from 'https://esm.sh/react@18.2.0';
import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
import { Calculator, AlertCircle, Check, Minus, Plus, FileText, RefreshCcw, Settings2 } from 'https://esm.sh/lucide-react@0.292.0';

/*****************
   CONFIG
*****************/
const CONFIG = {
  mwst: 0.19,
  preise: [
    { max: 10, preis: 5.5, label: "XS (bis 10cm)" },
    { max: 15, preis: 6.5, label: "S (bis 15cm)" },
    { max: 20, preis: 7.5, label: "M (bis 20cm)" },
    { max: 25, preis: 8.5, label: "L (bis 25cm)" },
    { max: 30, preis: 9.5, label: "XL (bis 30cm)" },
    { max: 35, preis: 10.5, label: "XXL (bis 35cm)" },
  ],
  rabatte: [
    { min: 1000, faktor: 0.3, label: "-70%" },
    { min: 500, faktor: 0.35, label: "-65%" },
    { min: 250, faktor: 0.45, label: "-55%" },
    { min: 100, faktor: 0.6, label: "-40%" },
    { min: 50, faktor: 0.7, label: "-30%" },
    { min: 20, faktor: 0.8, label: "-20%" },
    { min: 10, faktor: 0.9, label: "-10%" },
    { min: 1, faktor: 1.0, label: "0%" },
  ],
  techniken: {
    dtf: { label: "DTF / Transfer", faktor: 1.0, desc: "Standard" },
    flex: { label: "Flex / Flock", faktor: 1.2, desc: "+20% (Handarbeit)" },
  },
  extraKosten: { grafik: 20.0, datei: 25.0, fremdware: 1.5 },
  faktoren: { reflektor: 1.2, wiederverkaeufer: 0.8, farbStep: 0.25 },
};

const formatEUR = (val) => new Intl.NumberFormat("de-DE", { style: "currency", currency: "EUR" }).format(val);

/*****************
   PREISBERECHNUNG
*****************/
function calculatePrice(state) {
  const { laenge, breite, stueckzahl, farben, technik, extras } = state;
  const maxKante = Math.max(laenge, breite);
  const staffel = CONFIG.preise.find((s) => maxKante <= s.max);
  if (!staffel) return { error: "Größe überschreitet Standardmaße (max 35cm)." };

  const grundpreis = staffel.preis;
  const farbFaktor = 1 + CONFIG.faktoren.farbStep * (Math.min(3, farben) - 1);
  const technikFaktor = CONFIG.techniken[technik]?.faktor ?? 1;
  const reflektorFaktor = extras.reflektor ? CONFIG.faktoren.reflektor : 1;
  const rabatt = CONFIG.rabatte.find((r) => stueckzahl >= r.min) || { faktor: 1, label: "0%" };

  let einzel = grundpreis * farbFaktor * technikFaktor * reflektorFaktor * rabatt.faktor;
  if (extras.wiederverkaeufer) einzel *= CONFIG.faktoren.wiederverkaeufer;
  einzel += extras.fremdware ? CONFIG.extraKosten.fremdware : 0;

  const fix = (extras.grafik ? CONFIG.extraKosten.grafik : 0) + (extras.datei ? CONFIG.extraKosten.datei : 0);

  const totalNetto = einzel * stueckzahl + fix;
  const totalBrutto = totalNetto * (1 + CONFIG.mwst);

  return {
    error: null,
    details: {
      staffelLabel: staffel.label,
      grundpreis,
      rabattLabel: rabatt.label,
      einzelNetto: einzel,
      fixkosten: fix,
    },
    totalNetto,
    totalBrutto,
  };
}

/*****************
    STORAGE
*****************/
const LOCAL_STORAGE_KEY = 'stickbee_calc_state';
const DEFAULT_STATE = {
  laenge: 10,
  breite: 10,
  stueckzahl: 10,
  farben: 1,
  technik: "dtf",
  extras: { grafik: false, datei: false, fremdware: false, wiederverkaeufer: false, reflektor: false },
};

/*****************
    UI ELEMENTE
*****************/
const NumberControl = ({ label, value, onChange, min = 1, max = 35, step = 0.5, suffix="" }) => (
  <div className="flex flex-col gap-1.5">
    <label className="text-xs font-medium text-slate-400 uppercase tracking-wider">{label}</label>
    <div className="flex items-center bg-slate-900 rounded-lg border border-slate-700 p-1">
      <button onClick={() => onChange(Math.max(min, value - step))} className="w-10 h-10 flex items-center justify-center rounded bg-slate-800 text-slate-300"><Minus size={16}/></button>
      <div className="flex-1 h-10 text-center text-lg text-white flex items-center justify-center">{value} <span className="text-slate-500 text-sm ml-1">{suffix}</span></div>
      <button onClick={() => onChange(Math.min(max, value + step))} className="w-10 h-10 flex items-center justify-center rounded bg-slate-800 text-slate-300"><Plus size={16}/></button>
    </div>
  </div>
);

const Toggle = ({ label, checked, onChange, priceInfo }) => (
  <div onClick={() => onChange(!checked)} className={`flex items-center justify-between p-3 rounded-lg border cursor-pointer transition-all ${checked ? "bg-blue-900/20 border-blue-500/50" : "bg-slate-800/50 border-slate-700"}`}>
    <div className="flex flex-col"><span className="text-sm font-medium">{label}</span>{priceInfo && <span className="text-xs text-slate-500">{priceInfo}</span>}</div>
    <div className={`w-10 h-6 rounded-full relative ${checked ? "bg-blue-500" : "bg-slate-600"}`}>
      <div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-transform ${checked ? "left-5" : "left-1"}`} />
    </div>
  </div>
);

/*****************
    FOOTER (STICKY)
*****************/
const ResultFooter = ({ result, handleReset }) => {
  if (result.error) return null;
  return (
    <div className="sticky bottom-0 w-full mt-6 bg-slate-800 border-t border-slate-700 shadow-xl z-20">
      <div className="max-w-xl mx-auto p-4 flex items-center justify-between">
        <div>
          <h2 className="text-slate-400 text-xs uppercase font-bold">Gesamtsumme (inkl. MwSt)</h2>
          <div className="text-2xl font-bold text-white">{formatEUR(result.totalBrutto)}</div>
        </div>
        <button onClick={handleReset} className="px-4 py-3 rounded-lg bg-blue-600 text-white font-semibold flex items-center gap-2"><RefreshCcw size={18}/>Zurücksetzen</button>
      </div>
    </div>
  );
};

/*****************
     APP
*****************/
function App(){
  const [state, setState] = useState(DEFAULT_STATE);
  const result = useMemo(() => calculatePrice(state), [state]);

  return (
    <div className="min-h-screen p-4 md:p-8 flex flex-col items-center font-sans pb-8">
      <div className="w-full max-w-xl">
        <div className="flex items-center gap-3 mb-6">
          <div className="p-3 bg-blue-600 rounded-xl"><Calculator className="text-white"/></div>
          <div><h1 className="text-2xl font-bold text-white">Stick-Bee Kalkulator</h1><p className="text-slate-400 text-sm">Preise für Textilveredelung berechnen</p></div>
        </div>

        {/* Basisdaten */}
        <div className="bg-slate-900 border border-slate-800 rounded-2xl p-5 mb-6">
          <div className="flex items-center gap-2 mb-4 text-white font-semibold"><Settings2 size={18}/> Basisdaten</div>

          <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <NumberControl label="Länge" value={state.laenge} onChange={(v)=>setState({...state, laenge:v})} suffix="cm" />
            <NumberControl label="Stückzahl" value={state.stueckzahl} onChange={(v)=>setState({...state, stueckzahl:v})} suffix="Stück" min={1} max={10000} step={1}/>
            <NumberControl label="Breite" value={state.breite} onChange={(v)=>setState({...state, breite:v})} suffix="cm" />
            <NumberControl label="Farben" value={state.farben} onChange={(v)=>setState({...state, farben:v})} min={1} max={3} step={1} />
          </div>

          {/* Technik */}
          <div className="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3">
            {Object.entries(CONFIG.techniken).map(([key, tech]) => (
              <button key={key} onClick={()=>setState({...state, technik:key})}
                className={`p-3 rounded-lg border text-left ${state.technik===key?"bg-blue-600 border-blue-500 text-white":"bg-slate-800 border-slate-700 text-slate-400"}`}
              >
                <div className="font-bold text-sm">{tech.label}</div>
                <div className="text-xs">{tech.desc}</div>
              </button>
            ))}
          </div>
        </div>

        {/* Optionen */}
        <div className="bg-slate-900 border border-slate-800 rounded-2xl p-5 mb-6">
          <div className="flex items-center gap-2 mb-4 text-white font-semibold"><FileText size={18}/> Optionen & Service</div>
          <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <Toggle label="Grafikbearbeitung" checked={state.extras.grafik} onChange={(v)=>setState({...state, extras:{...state.extras, grafik:v}})} priceInfo="+20€" />
            <Toggle label="Dateiaufbereitung" checked={state.extras.datei} onChange={(v)=>setState({...state, extras:{...state.extras, datei:v}})} priceInfo="+25€" />
            <Toggle label="Reflektor-Material" checked={state.extras.reflektor} onChange={(v)=>setState({...state, extras:{...state.extras, reflektor:v}})} priceInfo="+20%" />
            <Toggle label="Fremdware" checked={state.extras.fremdware} onChange={(v)=>setState({...state, extras:{...state.extras, fremdware:v}})} priceInfo="+1,50€ / Stück" />
            <Toggle label="Wiederverkäufer" checked={state.extras.wiederverkaeufer} onChange={(v)=>setState({...state, extras:{...state.extras, wiederverkaeufer:v}})} priceInfo="-20%" />
          </div>
        </div>

        {/* Details */}
        {!result.error && (
          <div className="bg-slate-900 border border-slate-800 rounded-2xl p-5">
            <h3 className="text-lg font-bold text-white mb-4">Berechnungsdetails</h3>

            {result.details.rabattLabel !== "0%" && (
              <div className="bg-emerald-400/10 p-3 rounded-lg border border-emerald-400/20 text-emerald-400 mb-4 flex items-center gap-2"><Check size={16}/>Mengenrabatt: {result.details.rabattLabel}</div>
            )}

            <div className="bg-slate-950/40 border border-slate-800 rounded-xl p-4 mb-4 grid grid-cols-2 gap-y-3 text-sm">
              <span className="text-slate-300">Grundpreis ({result.details.staffelLabel})</span>
              <span className="text-right font-semibold text-slate-200">{formatEUR(result.details.grundpreis)}</span>

              <span className="text-slate-400">Stückpreis Veredelung (netto)</span>
              <span className="text-right font-semibold text-white">{formatEUR(result.details.einzelNetto)}</span>

              <span className="text-slate-400">Stückzahl</span>
              <span className="text-right text-white">× {state.stueckzahl}</span>

              {result.details.fixkosten > 0 && (
                <>
                  <span className="text-amber-200 border-t border-slate-700/50 pt-2 mt-2 col-span-1">Fixkosten</span>
                  <span className="text-right font-semibold text-amber-200 border-t border-slate-700/50 pt-2 mt-2 col-span-1">{formatEUR(result.details.fixkosten)}</span>
                </>
              )}
            </div>

            <div className="bg-slate-950 p-4 rounded-lg grid grid-cols-2 gap-y-2">
              <span className="text-slate-400">Netto gesamt</span>
              <span className="text-right text-lg font-bold text-white">{formatEUR(result.totalNetto)}</span>

              <span className="text-slate-500 text-xs">MwSt (19%)</span>
              <span className="text-right text-xs text-slate-500">{formatEUR(result.totalBrutto - result.totalNetto)}</span>
            </div>
          </div>
        )}

        <ResultFooter result={result} handleReset={()=>setState(DEFAULT_STATE)} />

      </div>
    </div>
  );
}

createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
